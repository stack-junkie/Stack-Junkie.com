class n extends Error{type="AstroUserError";hint;name="AstroUserError";constructor(t,e){super(),this.message=t,this.hint=e}static is(t){return t.type==="AstroUserError"}}class l{LETTER_FADE_DURATION=[2,7];baseCanvas;overlayCanvas;baseCtx;overlayCtx;width=window.innerWidth;height=window.innerHeight;letterPositions=[];letterInstances=[];primaryRgb;constructor(t,e){const s=t.getContext("2d"),r=e.getContext("2d");if(!s||!r)throw new n("Unable to get 2D context.");this.baseCanvas=t,this.overlayCanvas=e,this.baseCtx=s,this.overlayCtx=r,t.width=this.width,t.height=this.height,e.width=this.width,e.height=this.height,this.primaryRgb=window.getComputedStyle(document.documentElement).getPropertyValue("--primary-rgb").trim(),this.initBackground(),requestAnimationFrame(this.redrawBackground)}initBackground=()=>{let t=document.title.toLowerCase().split(" | ")[0].replace(/\s/g,"_")||"spectre";t.includes("_")&&(t+="_");const e=Math.ceil(this.width/17),s=Math.ceil(this.height/35);this.baseCtx.font="28px Geist Mono",this.baseCtx.textAlign="start",this.baseCtx.textBaseline="top",this.baseCtx.fillStyle="rgba(255, 255, 255, 0.01)";for(let i=0;i<s;i++)for(let a=0;a<e;a++)this.baseCtx.fillText(t[a%t.length],a*17,i*35),this.letterPositions.push({x:a*17,y:i*35,letter:t[a%t.length]});const r=this.getRandomAmountFromArray(this.letterPositions,Number.parseInt((s*.75).toFixed()));this.overlayCtx.font="bold 28px Geist Mono",this.overlayCtx.textAlign="start",this.overlayCtx.textBaseline="top",this.overlayCtx.fillStyle=`rgba(${this.primaryRgb}, 0)`,this.overlayCtx.shadowBlur=16,this.overlayCtx.shadowColor=`rgba(${this.primaryRgb}, 0)`;for(const i of r){this.overlayCtx.fillText(i.letter,i.x,i.y);const a=this.LETTER_FADE_DURATION[0]+Math.random()*(this.LETTER_FADE_DURATION[1]-this.LETTER_FADE_DURATION[0]);this.letterInstances.push({x:i.x,y:i.y,letter:i.letter,timestamp:Date.now(),fadeout:Date.now()+a*1e3})}this.baseCanvas.style.opacity="1"};easeInOutSine=(t,e,s)=>{const r=s-e;if(t<e)return 0;if(t>s){const h=(t-s)/(r/2);return Math.sin(h*Math.PI)}const i=(t-e)/r;return Math.max(0,.5-.5*Math.cos(i*Math.PI))};getRandomAmountFromArray=(t,e=20)=>{let s=t.length;const r=new Array(e),i=new Array(s);if(e>s)throw new n("getRandomAmountFromArray: more elements taken than available");for(;e--;){const a=Math.floor(Math.random()*s);r[e]=t[a in i?i[a]:a],i[a]=--s in i?i[s]:s}return r};redrawBackground=()=>{this.overlayCtx.clearRect(0,0,this.overlayCanvas.width,this.overlayCanvas.height),this.overlayCtx.font="bold 28px Geist Mono",this.overlayCtx.textAlign="start",this.overlayCtx.textBaseline="top",this.overlayCtx.shadowBlur=16;for(const t of this.letterInstances){if(t.fadeout>Date.now())continue;const e=this.easeInOutSine(Date.now(),t.timestamp,t.fadeout);if(e<=0&&Date.now()>t.fadeout){this.letterInstances.splice(this.letterInstances.indexOf(t),1);const s=this.getRandomAmountFromArray(this.letterPositions,1);this.letterInstances.push({x:s[0].x,y:s[0].y,letter:s[0].letter,timestamp:Date.now(),fadeout:Date.now()+(this.LETTER_FADE_DURATION[0]+Math.random()*(this.LETTER_FADE_DURATION[1]-this.LETTER_FADE_DURATION[0]))*1e3})}this.overlayCtx.fillStyle=`rgba(${this.primaryRgb}, ${e})`,this.overlayCtx.shadowColor=`rgba(${this.primaryRgb}, ${e})`,this.overlayCtx.fillText(t.letter,t.x,t.y)}requestAnimationFrame(this.redrawBackground)};resizeBackground=()=>{this.width=window.innerWidth,this.height=window.innerHeight,this.baseCanvas.width=this.width,this.baseCanvas.height=this.height,this.overlayCanvas.width=this.width,this.overlayCanvas.height=this.height,this.baseCtx.clearRect(0,0,this.baseCanvas.width,this.baseCanvas.height),this.overlayCtx.clearRect(0,0,this.overlayCanvas.width,this.overlayCanvas.height),this.letterInstances=[],this.letterPositions=[],this.initBackground()}}async function d(){const o=new FontFace("Geist Mono","url(/fonts/GeistMono.woff2)");await o.load(),document.fonts.add(o)}async function c(){await d();const o=document.getElementById("bg-canvas"),t=document.getElementById("overlay-canvas"),e=new l(o,t);window.addEventListener("resize",()=>{e.resizeBackground()})}c();
